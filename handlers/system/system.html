{% extends base.html %}

{% block head %}
    <style type="text/css">
        .sys-cmd-no {
            width: 10%;
            max-width: 100px;
        }
        .sys-cmd {
            width: 70%;
        }
        h3 {
            background: #ccf;
            padding: 5px;
        }
        a {
            text-decoration: none;
            color: #08c;
        }
        .item {
            width: 150px;
            float: left;
        }
    </style>
{% end %}

{% block body %}
<script type="text/javascript" src="/static/lib/string-format/string-format.min.js"></script>
<script type="text/javascript" src="/static/lib/jquery.qrcode/jquery.qrcode.min.js"></script>

<input class="hide" id="addr" value="{{?addr}}" />

<div class="barcode col-md-12" style="margin:0 auto; text-align: center;">
    {% if _has_login %}
    <p>Hello, {{_user_name}}! <a href="/logout">登出</a></p>
    {% else %}
    <p>Hello, 游客! <a href="/login">登陆</a></p>
    {% end %}
    {% set site_home = 'http://' + xconfig.get("SITE_HOME", addr) %}
    <p>地址 <a href="{{site_home}}">{{site_home}}</a>
        <input type="button" id="toggleBarCode" class="btn" value="二维码">
    </p>
    <div id="qrcode" class="hide"></div>
</div>

{% for category in xconfig.MENU_LIST %}
    {% if category.need_login and not _has_login %}
        {% continue %}
    {% end %}
    {% if category.need_admin and not _is_admin %}
        {% continue %}
    {% end %}
    <div class="col-md-12 top-offset-1">
        <h3>{{category.name}}</h3>
        <div class="col-md-12">
            {% for link in category.children %}
            <div class="item">
                <a href="{{link.url}}">{{link.name}}</a>
            </div>
            {% end %}
        </div>
    </div>
{% end %}

<script type="text/javascript">
$("#menu-sys").addClass("active");

$(function () {

    // $("#qrcode").hide();

    var addr = $("#addr").val();
    // var url = format("http://{}:{}", ip, port);
    var url = "http://" + addr;
    $("#qrcode").qrcode(url);
    function updateTime () {
        $("#currentDate").html(new Date().toString("yyyy-MM-dd HH:mm:ss"));
        setTimeout(updateTime, 1000);
    }

    updateTime();
})

function switchQrCode() {
    if ($("#qrcode").css("display") == "none") {
        $("#qrcode").show();
    } else {
        $("#qrcode").hide();
    }
}

$("#toggleBarCode").on("click", switchQrCode);

function runCommand(path) {
    // alert("runCommand "+ path);
    $.get("/system/command", {path: path}, function(data, status) {
        alert(data);
    })
}


</script>
{% end %}