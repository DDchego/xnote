{% init files = [] %}
{% init pseudo_groups = False %}
<div class="col-md-12">
    <table class="col-md-12 table">

    {% if pseudo_groups %}
        <tr>
            <td>
                <img src="/static/image/folder.gif">
                <a href="/file/group/ungrouped">未分类</a> /
            </td>
            <td></td>
        </tr>
        <tr>
            <td>
                <img src="/static/image/folder.gif">
                <a href="/file/group/removed">回收站</a> /
            </td>
            <td></td>
        </tr>
    {% end %}

    {% for i, item in enumerate(files) %}
        <tr>
            <td>
                {% if item.type == "group" %}
                    <img src="/static/image/folder.gif"/>
                {% else %}
                {% end %}
                <a href="/file/view?id={{item.id}}" id="file-{{item.id}}">{{item.name}}</a>
                {% if item.type == "group" %}/{% end %}
                <a class="hover" href="javascript:rename({{item.id}})">重命名</a>
                {% if _is_admin %}
                    <a class="hover" href="javascript:remove({{item.id}}, '{{item.name}}')">删除</a>
                {% end %}
                <div style="font-size: 12px;"><span class="tag">{{item.groups}}</span>&nbsp;{{item.sctime}} </div>
            </td>
            <td><a href="/file/archive?id={{item.id}}">整理</a></td>
        </tr>
    {% end %}
    </table>
</div>

{% if "page" in globals() %}
    {% include mod_pagenation.html %}
{% end %}
<script type="text/javascript">
function rename(id) {
    var newName = prompt("新名称");
    console.log(newName);
    if (newName != "" && newName != null) {
        $.post("/file/rename", {id:id, name:newName}, function (resp) {
            var code = resp.code;
            if (code != "success") {
                alert(resp.message);
            } else {
                $("#file-"+id).text(newName);
            }
        })
    }
}

function remove(id, name) {
    var confirmed = confirm("确定删除'" + name + "'?");
    if (confirmed) {
        $.post("/file/remove", {id:id}, function (resp) {
            var code = resp.code;
            if (code != "success") {
                alert(resp.message);
            } else {
                window.location.reload();
            }
        })
    }
}
</script>