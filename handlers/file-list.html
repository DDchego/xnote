{% extends base.html %}

{% block head %}
    <!-- <link rel="stylesheet" href="/css/table.css"/> -->
    <link rel="stylesheet" type="text/css" href="/static/lib/bootstrap-tagsinput/bootstrap-tagsinput.css"/>

<style>

.tool-div {
    font-size: medium;
}

.tool-div a {
    font-size: medium;
    color: blue;
}

.tool-description {
    font-size: small;
    padding-top: 3px;
}


.note {
    float: inherit;
    border: solid 1px;
    border-color: #ccc;
    background-color: #fff;
    padding: 10px;
    margin-bottom: 10px;
}

.note-head {
    font-size: 20px;
}

.note-name {
    /*font-size: 20px;*/
}

.note-name a {
    font-size: medium;
    color: blue;
}

.note-content-short {
    font-size: small;
    word-break: break-all;
}

.note-last-modify-time,
.note-last-visit-time {
    padding-left: 2px;
    padding-top: 2px;
    font-size: small;
    color: green;
}

.note-related {
    font-size: 6px;
    padding-left: 5px;
    color: red;
    display: none;
}
.note-visited-cnt {
    float: right;
    font-size: small;
}

.tag {
    font-size: small;
    background-color: green;
    color: white;
}

.red-tag {
    font-size: small;
    background-color: red;
    color: white;
}

</style>
{% end %}

{% block body %}
    {% include "file/header.html" %}
   <br/>
   <script type="text/javascript">$("#menu-file").addClass("active");</script>

   <!-- Files -->
   <div class="">
        {% for i, file in enumerate(files) %}
            <div class="note">
                <div class="note-visited-cnt">访问指数:{{file.visited_cnt}}</div>
                <div class="note-name">
                    <a href="{{file.url}}">{{file.name}}</a>
                    {% if file.groups == "*" %}
                        <span class="tag">公开</span>
                    {% elif file.groups != None %}
                        <span class="red-tag">{{file.groups}}</span>
                    {% end %}
                </div>
                
                {% if "raw" in file %}
                    <pre>{{ file.raw }}</pre>
                {% else %}
                    <div class="note-content-short">{{file.content[:100]}}</div>
                {% end %}
                {% if file.smtime != None %}
                    <div class="note-last-visit-time">最近编辑:{{file.smtime}}</div>
                {% end %}
                <!-- <div class="note-last-modify-time">最近编辑:{{file.smtime}}</div> -->
                <div class="note-related">
                    <input type="text" data-role="tagsinput" value="{{file.related}}"/>
                </div>
                <div class="note-option">
                </div> 
            </div>
        {% end %}
    </div>
    
{% if "page" in globals() %}
    {% set pages = math.ceil(count/10) %}
    {% if page == 1 and len(files) < 5 and key != "" %}
        {# TODO 移动端优化 #}
        <div class="note">
            <div class="note-name">
                结果太少?看看搜索引擎的结果吧~
            </div>
            <div class="note-content-short">
                <br/>
                <a href="https://www.baidu.com/s?wd={{key}}" target="_blank">百度</a>
                <a href="https://www.google.com/search?q={{key}}" target="_blank">谷歌</a>
            </div>
        </div>
    {% end %}

    <p>
        <input id="targetPage" value="{{page}}" style="width:3em;"/> <button onclick="goToPage()">GO</button>
        {% if page > 1 %}
        <a href="{{page_url}}{{page-1}}">Prev</a>
        {% end %}
        <a href="#"><span style="background:blue;color:white">{{page}} / {{?pages}}</span></a>
        {% if page < pages %}
        <a href="{{page_url}}{{page+1}}">Next</a>
        {% end %}
    </p>
    <script>
        function goToPage() {
            var value = $('#targetPage').val();
            location.href = '{{page_url}}' + (value);
        }
    </script>
{% end %}

<script type="text/javascript" src="/static/lib/jquery.qrcode/jquery.qrcode.min.js"></script>
<script type="text/javascript" src="/static/lib/bootstrap-tagsinput/bootstrap-tagsinput.min.js"></script>

{% end %}