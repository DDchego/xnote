{% extends base.html %}

{% block head %}
    <!-- <link rel="stylesheet" href="/css/table.css"/> -->
    <link rel="stylesheet" type="text/css" href="/static/lib/bootstrap-tagsinput/bootstrap-tagsinput.css"/>

<style>

.tool-div {
    font-size: medium;
}

.tool-div a {
    font-size: medium;
    color: blue;
}

.tool-description {
    font-size: small;
    padding-top: 3px;
}
.note {
    float: inherit;
    border: solid 1px;
    border-color: #ccc;
    background-color: #fff;
    padding: 10px;
    margin-bottom: 10px;
}

.note-head {
    font-size: 20px;
}

.note-name {
    /*font-size: 20px;*/
}

.note-name a {
    font-size: medium;
    color: blue;
}

.note-content-short {
    font-size: small;
    word-break: break-all;
}

.note-last-modify-time,
.note-last-visit-time {
    padding-left: 2px;
    padding-top: 2px;
    font-size: small;
    color: green;
}

.note-related {
    font-size: 6px;
    padding-left: 5px;
    color: red;
    display: none;
}
.note-visited-cnt {
    float: right;
    font-size: small;
}

.tag {
    font-size: small;
    background-color: green;
    color: white;
    border-radius: 2px;
    padding-left: 2px;
    padding-right: 2px;
}

.red-bg {
    background-color: red;
}

.red-tag {
    font-size: small;
    background-color: red;
    color: white;
    border-radius: 2px;
    padding-left: 2px;
    padding-right: 2px;
}

.x-page-link {
    border: 1px solid #ccc;
    text-decoration: none;
    /*padding:2px;*/
    padding-left: 5px;
    padding-right: 5px;
    color: #000;
}
.x-page-active {
    background-color: red;
}
</style>
{% end %}

{% block body %}
    {% include "search.html" %}
   <br/>
   <script type="text/javascript">$("#menu-file").addClass("active");</script>

   <!-- Files -->
   <div class="">
        {% for i, file in enumerate(files) %}
            <div class="note">
                <div class="note-visited-cnt">访问指数:{{file.visited_cnt}}</div>
                <div class="note-name">
                    <a href="{{file.url}}">{{file.name}}</a>
                    
                </div>
                
                {% if file.raw != None %}
                    <pre>{{ file.raw }}</pre>
                {% end %}

                {# 快捷命令 #}
                {% if file.command != None %}
                    <input type="button" class="btn execute-btn" value="执行" href="{{file.command}}"/>
                    <span class="execute-result"></span>
                {% end %}

                <div>
                    {% if hasattr(file, "priority") and file.priority is not None and file.priority > 0 %}
                        <span class="tag red-bg">置顶</span>
                    {% end %}
                    {% if file.groups == "*" %}
                        <span class="tag">公开</span>
                    {% elif file.groups != None %}
                        <span class="tag">{{file.groups}}</span>
                    {% end %}

                    {% if file.smtime != None %}
                        <span class="note-last-visit-time">最近编辑:{{file.smtime}}</span>
                    {% end %}
                </div>
                <div class="note-related">
                    <input type="text" data-role="tagsinput" value="{{file.related}}"/>
                </div>
                <div class="note-option">
                </div> 
            </div>
        {% end %}
    </div>
    
{% if "page" in globals() %}
    {% init key = "" %}
    {% set pages = math.ceil(count/10) %}
    {% if key != "" %}
        {# TODO 移动端优化 #}
        <div class="note">
            <div class="note-name">
                没找到结果?看看搜索引擎的结果吧~
            </div>
            <div class="note-content-short">
                <br/>
                <a href="https://www.baidu.com/s?wd={{key}}" target="_blank">百度</a>
                <a href="https://www.google.com/search?q={{key}}" target="_blank">谷歌</a>
                <a href="https://www.bing.com/search?q={{key}}" target="_blank">必应</a>
            </div>
        </div>
    {% end %}

    <p>
        <!--
        <input id="targetPage" value="{{page}}" style="width:3em;"/> <button onclick="goToPage()">GO</button>
        -->
        <a class="x-page-link" href="#">共{{pages}}页</a> 
        {% if page > 1 %}
        <a class="x-page-link" href="{{page_url}}{{page-1}}">上一页</a>
        {% end %}
        
        <a class="x-page-link x-page-active" href="#">{{page}}</a>
        <!--
        <a href="#"><span style="background:blue;color:white">{{page}} / {{?pages}}</span></a>
        -->
        
        {% if page < pages %}
        <a class="x-page-link" href="{{page_url}}{{page+1}}">下一页</a>
        {% end %}
    </p>
    <script>
        function goToPage() {
            var value = $('#targetPage').val();
            location.href = '{{page_url}}' + (value);
        }
        $(".execute-btn").on("click", function (e) {
            console.log(e);
            var href = $(e.target).attr("href");
            $.get(href, function (responseText) {
                $(".execute-result").text(responseText);
            });
        })
    </script>
{% end %}

<script type="text/javascript" src="/static/lib/jquery.qrcode/jquery.qrcode.min.js"></script>
<script type="text/javascript" src="/static/lib/bootstrap-tagsinput/bootstrap-tagsinput.min.js"></script>

{% end %}